<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>IndexController 接口页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h2 { color: #333; }
        form { margin-bottom: 20px; }
        input[type="text"] { width: 300px; padding: 5px; }
        input[type="submit"] { padding: 5px 10px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #aaa; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>

<script>    // 封装一个函数用于提交表单并刷新页面
function submitForm(event, url) {
    event.preventDefault(); // 阻止默认提交行为

    const form = event.target;
    const formData = new FormData(form);
    const params = new URLSearchParams(formData);

    fetch(url + '?' + params, {
        method: 'GET'
    }).then(() => {
        location.reload(); // 提交完成后刷新页面
    }).catch(err => {
        alert('请求失败，请重试');
        console.error(err);
    });
}

document.addEventListener("DOMContentLoaded", function () {
    const qsyForm = document.getElementById('qsyForm');
    const qsyResultDiv = document.getElementById('qsyResult');

    qsyForm.addEventListener('submit', function (event) {
        event.preventDefault();

        const urlParam = document.getElementById('qsyUrlInput').value;
        const apiUrl = '/qsy?url=' + encodeURIComponent(urlParam);

        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('网络响应异常');
                }
                return response.json();
            })
            .then(data => {
                // 构建表格 HTML
                let tableHtml = `                    <h3>接口返回数据</h3>
                    <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
                        <tr><th>字段</th><th>值</th></tr>
                        <tr><td>状态码 (states)</td><td>${data.success || '-'}</td></tr>
                        <tr><td>视频链接 (video_url)</td><td>${data.data?.video_url || '-'}</td></tr>
                        <tr><td>下载url (download_url)</td><td>${data.data?.download_url || '-'}</td></tr>
                        <tr><td>图片链接 (image_url)</td><td>${data.data?.image_url || '-'}</td></tr>
                    </table>
                `;
                qsyResultDiv.innerHTML = tableHtml;
            })
            .catch(error => {
                qsyResultDiv.innerHTML = `<p style="color:red;">请求失败：${error.message}</p>`;
                console.error(error);
            });
    });
});

</script>

<body>
<h2>添加监控 URL</h2>
<form  onsubmit="submitForm(event, '/add/monitor/url')">
    <input type="text" name="url" placeholder="输入监控 URL" required/>
    <input type="submit" value="提交"/>
</form>

<h2>添加 Push ID</h2>
<form onsubmit="submitForm(event, '/add/push/id')">
    <input type="text" name="uid" placeholder="输入 Push ID" required/>
    <input type="submit" value="提交"/>
</form>

<h2>执行批量任务</h2>
<form onsubmit="submitForm(event, '/exe')">
    <input type="submit" value="执行"/>
</form>


<h2>调用 QSY 接口</h2>
<form id="qsyForm">
    <input type="text" id="qsyUrlInput" name="url" placeholder="输入 URL 参数" required />
    <input type="submit" value="调用接口" />
</form>

<!-- 展示接口返回数据 -->
<div id="qsyResult" style="margin-top: 20px;"></div>


<h2>监控用户列表</h2>
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>昵称</th>
        <th>解析 URL</th>
        <th>ZP 计数</th>
        <th>创建时间</th>
        <th>更新时间</th>
    </tr>
    </thead>
    <tbody>
    <!--/*@thymesVar id="monitorUsers" type="java.util.List<com.ds.dy_xhs_monitor.entity.MonitorUser>"*/-->
    <tr th:each="user : ${monitorUsers}">
        <td th:text="${user.id}">ID</td>
        <td th:text="${user.nickName}">昵称</td>
        <td th:text="${user.parseUrl}">解析 URL</td>
        <td th:text="${user.zpCount}">ZP 计数</td>
        <td th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd HH:mm:ss')}">创建时间</td>
        <td th:text="${#temporals.format(user.updatedAt, 'yyyy-MM-dd HH:mm:ss')}">更新时间</td>
    </tr>
    </tbody>
</table>
</body>
</html>
